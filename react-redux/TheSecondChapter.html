<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第二章 | Do .</title>
    <meta name="description" content="差劲的程序员操心代码，优秀的程序员操心数据结构和他们之间的关系。">
    <link rel="icon" href="/v-ZHD-loong/logo.png">
    
    <link rel="preload" href="/v-ZHD-loong/assets/css/0.styles.a82533d4.css" as="style"><link rel="preload" href="/v-ZHD-loong/assets/js/app.7f934088.js" as="script"><link rel="preload" href="/v-ZHD-loong/assets/js/12.5e663ca4.js" as="script"><link rel="prefetch" href="/v-ZHD-loong/assets/js/10.6c0dd5ca.js"><link rel="prefetch" href="/v-ZHD-loong/assets/js/11.bb86d2f9.js"><link rel="prefetch" href="/v-ZHD-loong/assets/js/13.b984abd0.js"><link rel="prefetch" href="/v-ZHD-loong/assets/js/14.b03a58da.js"><link rel="prefetch" href="/v-ZHD-loong/assets/js/15.6c6ae60f.js"><link rel="prefetch" href="/v-ZHD-loong/assets/js/16.fea05cc9.js"><link rel="prefetch" href="/v-ZHD-loong/assets/js/2.163ee670.js"><link rel="prefetch" href="/v-ZHD-loong/assets/js/3.0f31d3ec.js"><link rel="prefetch" href="/v-ZHD-loong/assets/js/4.18323367.js"><link rel="prefetch" href="/v-ZHD-loong/assets/js/5.b315c784.js"><link rel="prefetch" href="/v-ZHD-loong/assets/js/6.1d1319c4.js"><link rel="prefetch" href="/v-ZHD-loong/assets/js/7.c781437d.js"><link rel="prefetch" href="/v-ZHD-loong/assets/js/8.842a94eb.js"><link rel="prefetch" href="/v-ZHD-loong/assets/js/9.0d21ddf5.js">
    <link rel="stylesheet" href="/v-ZHD-loong/assets/css/0.styles.a82533d4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/v-ZHD-loong/" class="home-link router-link-active"><!----> <span class="site-name">Do .</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/v-ZHD-loong/" class="nav-link">ZHD</a></div><div class="nav-item"><a href="/v-ZHD-loong/guide/" class="nav-link">Github</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/v-ZHD-loong/" class="nav-link">ZHD</a></div><div class="nav-item"><a href="/v-ZHD-loong/guide/" class="nav-link">Github</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Dauly</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>深入件出React和Redux</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/v-ZHD-loong/react-redux/" class="sidebar-link">Introduction</a></li><li><a href="/v-ZHD-loong/react-redux/Thefirstone.html" class="sidebar-link">第一章</a></li><li><a href="/v-ZHD-loong/react-redux/TheSecondChapter.html" class="active sidebar-link">第二章</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/v-ZHD-loong/react-redux/TheSecondChapter.html#设计高质量的react组件" class="sidebar-link">设计高质量的React组件</a></li><li class="sidebar-sub-header"><a href="/v-ZHD-loong/react-redux/TheSecondChapter.html#易于维护的组件设计要素" class="sidebar-link">易于维护的组件设计要素</a></li><li class="sidebar-sub-header"><a href="/v-ZHD-loong/react-redux/TheSecondChapter.html#react组件的数据" class="sidebar-link">React组件的数据</a></li><li class="sidebar-sub-header"><a href="/v-ZHD-loong/react-redux/TheSecondChapter.html#组件的生命周期" class="sidebar-link">组件的生命周期</a></li><li class="sidebar-sub-header"><a href="/v-ZHD-loong/react-redux/TheSecondChapter.html#装载阶段" class="sidebar-link">装载阶段</a></li><li class="sidebar-sub-header"><a href="/v-ZHD-loong/react-redux/TheSecondChapter.html#更新过程" class="sidebar-link">更新过程</a></li><li class="sidebar-sub-header"><a href="/v-ZHD-loong/react-redux/TheSecondChapter.html#组件向外传递数据" class="sidebar-link">组件向外传递数据</a></li><li class="sidebar-sub-header"><a href="/v-ZHD-loong/react-redux/TheSecondChapter.html#问题" class="sidebar-link">问题</a></li><li class="sidebar-sub-header"><a href="/v-ZHD-loong/react-redux/TheSecondChapter.html#react组件state和props的局限性" class="sidebar-link">React组件state和props的局限性</a></li><li class="sidebar-sub-header"><a href="/v-ZHD-loong/react-redux/TheSecondChapter.html#问题-2" class="sidebar-link">问题</a></li><li class="sidebar-sub-header"><a href="/v-ZHD-loong/react-redux/TheSecondChapter.html#总结" class="sidebar-link">总结</a></li></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>css</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>js</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="第二章"><a href="#第二章" aria-hidden="true" class="header-anchor">#</a> 第二章</h1> <h2 id="设计高质量的react组件"><a href="#设计高质量的react组件" aria-hidden="true" class="header-anchor">#</a> 设计高质量的React组件</h2> <p>``</p> <h2 id="易于维护的组件设计要素"><a href="#易于维护的组件设计要素" aria-hidden="true" class="header-anchor">#</a> 易于维护的组件设计要素</h2> <ul><li><code>分而治之</code>拆分为单个功能的组件
<ul><li>确定组件的边界
<ul><li>根据功能划分模块</li></ul></li> <li>高内聚、低耦合 todo (深层次的理解)
<ul><li>高内聚 把逻辑紧密相关的内容放在一个组件中。</li> <li>不同组件的关系尽量要弱化。</li></ul></li></ul></li></ul> <h2 id="react组件的数据"><a href="#react组件的数据" aria-hidden="true" class="header-anchor">#</a> React组件的数据</h2> <ul><li><code>props</code> 对外接口</li> <li><code>state</code> 内部状态</li></ul> <h3 id="区别"><a href="#区别" aria-hidden="true" class="header-anchor">#</a> 区别</h3> <ul><li>props用于定义外部接口，state用于记录内部状态</li> <li>props的赋值在外部使用，state在内部使用</li> <li>组件内部不能改变state，只能通过state让组件来改变的</li></ul> <p>升级版的 <code>2.2.1</code></p> <div class="danger custom-block"><p class="custom-block-title">react的类型检查PropTypes自React v15.5起已弃用，请使用prop-types</p> <p>import PropTypes from 'prop-types';</p> <pre><code>        p小写
</code></pre> <p>MyComponent.propTypes = {
// 你可以将属性声明为以下 JS 原生类型
optionalArray: PropTypes.array,
P大写</p></div> <h3 id="共同原则"><a href="#共同原则" aria-hidden="true" class="header-anchor">#</a> 共同原则</h3> <ul><li>都会引起组件的重新渲染</li></ul> <h2 id="组件的生命周期"><a href="#组件的生命周期" aria-hidden="true" class="header-anchor">#</a> 组件的生命周期</h2> <ul><li>阶段划分
<ul><li>装载阶段</li> <li>更新阶段</li> <li>卸载阶段</li></ul></li></ul> <h2 id="装载阶段"><a href="#装载阶段" aria-hidden="true" class="header-anchor">#</a> 装载阶段</h2> <ol><li><strong><code>constructor</code> 唯一会在服务端调用的函数</strong> <ul><li>形参
<ul><li>props</li> <li>context ？ 不知道是啥</li></ul></li></ul></li> <li><strong><code>componentWillMount</code></strong> <code>即将废弃</code></li> <li><strong><code>render</code> 最重要的函数 -&gt; 返回dom结构。必须纯函数</strong></li> <li><strong><code>componentDidMount</code></strong></li></ol> <ul><li>render执行后不会立即执行。在render后执行</li></ul> <h5 id="问题？"><a href="#问题？" aria-hidden="true" class="header-anchor">#</a> 问题？</h5> <p>为什么推荐在<code>componentDidMount中请求参数</code>？</p> <ul><li><p>componentWillMount方法的调用在constructor之后，在render之前，在这方法里的代码调用setState方法不会触发重渲染，所以它一般不会用来作加载数据之用，它也很少被使用到。</p></li> <li><p>一般的从后台(服务器)获取的数据，都会与组件上要用的数据加载有关，所以都在componentDidMount方法里面作。虽然与组件上的数据无关的加载，也可以在constructor里作，但constructor是作组件state初绐化工作，并不是设计来作加载数据这工作的，所以所有有副作用的代码都会集中在componentDidMount方法里。</p></li> <li><p>constructor()中获取数据的话，如果时间太长，或者出错，组件就渲染不出来，你整个页面都没法渲染了。</p></li> <li><p>componentDidMount()中能保证你的组件已经正确渲染。</p></li></ul> <h4 id="总结下："><a href="#总结下：" aria-hidden="true" class="header-anchor">#</a> 总结下：</h4> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p><a href="https://blog.csdn.net/ky1in93/article/details/81362442" target="_blank" rel="noopener noreferrer">原文地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ul><li>作者：嘴强王者菜月昴</li> <li>来源：CSDN</li></ul> <hr> <ul><li><p>constructor()</p> <ul><li><p>constructor()中获取数据的话，如果时间太长，或者出错，组件就渲染不出来，整个页面都没法渲染了。</p></li> <li><p>constructor是作组件state初绐化工作，并不是设计来作加载数据的。</p></li></ul></li> <li><p>componentWillMount()</p> <ul><li><p>如果使用SSR（服务端渲染）,componentWillMount会执行2次，一次在服务端，一次在客户端。而componentDidMount不会。</p></li> <li><p>constructor可以完成state初始化，componentWillMount使用的很少，目前16版本加入了UNSAFE来标识componentWillMount，新的生命周期static getDerivedStateFromProps()   也会替代这个。</p></li> <li><p>React16之后采用了Fiber架构，只有componentDidMount声明周期函数是确定被执行一次的，类似ComponentWillMount的生命周期钩子都有可能执行多次，所以不加以在这些生命周期中做有副作用的操作，比如请求数据之类。</p></li></ul></li> <li><p>render()</p> <ul><li>无限render</li></ul></li> <li><p>componentDidMount()</p> <ul><li><p>确保已经render过一次。提醒我们正确地设置初始状态，这样就不会得到导致错误的&quot;undefined&quot;状态。</p></li> <li><p>componentDidMount方法中的代码，是在组件已经完全挂载到网页上才会调用被执行，所以可以保证数据的加载。此外，在这方法中调用setState方法，会触发重渲染。所以，官方设计这个方法就是用来加载外部数据用的，或处理其他的副作用代码。</p></li></ul></li></ul></div> <ol><li><p>跟服务器端渲染（同构）有关系，如果在componentWillMount里面获取数据，fetch data会执行两次，一次在服务器端一次在客户端。在componentDidMount中可以解决这个问题。</p></li> <li><p>在componentWillMount中fetch数据一定在render后才能到达，如果你忘记了设置初始状态，用户体验不好。</p></li> <li><p>react16.0以后，componentWillMount可能会被执行多次。<code>服务端</code>、<code>客户端</code></p></li></ol> <h4 id="多个组件嵌套的生命周期函数装在执行顺序"><a href="#多个组件嵌套的生命周期函数装在执行顺序" aria-hidden="true" class="header-anchor">#</a> 多个组件嵌套的生命周期函数装在执行顺序</h4> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <ul><li>{count: 1} {} &quot;第一个生命周期函数&quot;</li> <li>componentWillMount app</li> <li>render</li> <li>constructorcount count</li> <li>componentWillMount count</li> <li>render CountApp</li> <li>constructorcount countApp</li> <li>componentWillMount CountApp</li> <li>render CountApp</li> <li>componentDidMount count</li> <li>componentDidMount CountApp</li> <li>componentDidMount app</li></ul></div> <div class="warning custom-block"><p class="custom-block-title">总结 `componentDidMount`只在客户端执行</p> <ul><li>componentWillMount与render紧密相连</li> <li>render本身不会渲染页面，只会返回</li> <li>当组件内部的所有render都调用完，才会依次执行所有的componenttDidMount</li></ul></div> <h2 id="更新过程"><a href="#更新过程" aria-hidden="true" class="header-anchor">#</a> 更新过程</h2> <p>componentWillReceiveProps
shouldComponentUpdate
componentWillUpdate
render
componentDidUpdate
</p> <img src="/v-ZHD-loong/react/reactcycle.png">
### `componentWillReceiveProps` 
::: warning 没改比props也会触发
- 只要是在父组件render函数调用，render里的子组件就会经历更新的过程，不管父组件传递给子组建的props有没有改变，都会触发子组件的componentWillReaciveProps
- this.setState 不会调用componentWillReaciveProps
:::
- 参数
    - nextProps
    - nextState
<h3 id="废除的属性-只在-createclass-中调用"><a href="#废除的属性-只在-createclass-中调用" aria-hidden="true" class="header-anchor">#</a> 废除的属性 只在 createClass 中调用</h3> <ul><li>getInitialState
<ul><li>getInitialState was defined on App, a plain JavaScript class. This is only supported for classes created using React.createClass. Did you mean to define a state property instead?</li></ul></li> <li>getDefaultProps
<ul><li>getDefaultProps was defined on App, a plain JavaScript class. This is only supported for classes created using React.createClass. Use a static property to define defaultProps instead.</li></ul></li></ul> <h2 id="组件向外传递数据"><a href="#组件向外传递数据" aria-hidden="true" class="header-anchor">#</a> 组件向外传递数据</h2> <h2 id="问题"><a href="#问题" aria-hidden="true" class="header-anchor">#</a> 问题</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * @author z
 * @file
 */</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> h <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> Count <span class="token keyword">from</span> <span class="token string">'./count'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> CountApp <span class="token keyword">from</span> <span class="token string">'./countApp'</span><span class="token punctuation">;</span>




<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      defaultVal<span class="token punctuation">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>eventClickSetVal <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>eventClickSetVal<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>


  <span class="token function">componentWillReceiveProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'父组件=》componentWillReceiveProps'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'父组件=》shouldComponentUpdate'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span>

  <span class="token punctuation">}</span>

  <span class="token function">eventClickSetVal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      defaultVal<span class="token punctuation">:</span> <span class="token number">10</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'父组件的render'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> h<span class="token punctuation">.</span><span class="token function">div</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      h<span class="token punctuation">.</span><span class="token function">h1</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'count'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

      <span class="token comment">// h(Count, {}, ''),</span>
      <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>defaultVal<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">h</span><span class="token punctuation">(</span>CountApp<span class="token punctuation">,</span> <span class="token punctuation">{</span> count<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>defaultVal <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      
      <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        onClick<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>eventClickSetVal
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'改变初始值'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Count</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
   
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      count<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>count 
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>onClickButton <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onClickButton<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token comment">//   static defaultProps.count = 0/</span>
<span class="token keyword">static</span> defaultProps <span class="token operator">=</span> <span class="token punctuation">{</span>
    count<span class="token punctuation">:</span> <span class="token number">1000</span>
<span class="token punctuation">}</span>
<span class="token function">componentWillReceiveProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'count组件=》componentWillReceiveProps'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'count组件=》shouldComponentUpdate'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> felse

<span class="token punctuation">}</span>

<span class="token comment">// methods</span>
  <span class="token function">onClickButton</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>count<span class="token punctuation">:</span> <span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'子组件的render'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
    h<span class="token punctuation">.</span><span class="token function">div</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    h<span class="token punctuation">.</span><span class="token function">p</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'state的值count: '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    h<span class="token punctuation">.</span><span class="token function">p</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'props的值count: '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>count<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

        h<span class="token punctuation">.</span><span class="token function">button</span><span class="token punctuation">(</span><span class="token punctuation">{</span>onClick<span class="token punctuation">:</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onClickButton</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'clickMe'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><img src="/v-ZHD-loong/react/reactWenti1.gif">
![](/react/reactWenti1.gif)
<h3 id="分析"><a href="#分析" aria-hidden="true" class="header-anchor">#</a> 分析</h3> <ul><li><p>父组件将<code>defaultVal</code>传递给子组建，子组件进入装载阶段,</p></li> <li><p>当父组件点击 <code>改变初始值的时候</code></p> <ul><li>父组件进入shouldComponentUpdate阶段</li> <li>父组件进入render</li> <li>子组件进入componentReaciveProps</li> <li>子组件进入shouldComponentUpdate阶段</li> <li>子组件的render 初始化页面</li> <li><code>props的值count</code> 依赖传递的props 更新了</li> <li><code>state的值count</code> 依赖于自己的state
<ul><li>自己的state 只是在constructor 时接收了props 当作自己的初始值。只会执行一次</li></ul></li></ul></li> <li><p><code>h.p({}, 'state的值count: ' + this.state.count, ''),</code> 依赖自己的state</p></li> <li><p><code>h.p({}, 'props的值count: ' + this.props.count, ''),</code> 依赖父组件props</p></li></ul> <div class="tip custom-block"><p class="custom-block-title">证明组件的comonentReactiveProps在props不改时也会触发</p> <p><strong>将子组件的 <code>h.p({}, 'props的值count: ' + this.props.count, ''),</code>注释</strong></p> <ul><li>这时子组件只接收props只在<code>constructor</code>时用到了</li> <li>点击父组件的<code>改变初始值</code></li></ul></div> <h3 id="shouldcomponentupdate-nextprops-nextstate-返回值决定是否渲染页面"><a href="#shouldcomponentupdate-nextprops-nextstate-返回值决定是否渲染页面" aria-hidden="true" class="header-anchor">#</a> shouldComponentUpdate(nextProps, nextState) 返回值决定是否渲染页面</h3> <h3 id="componentwillupdate-nextprops-nextstate-a-a-react-17-废弃"><a href="#componentwillupdate-nextprops-nextstate-a-a-react-17-废弃" aria-hidden="true" class="header-anchor">#</a> componentWillUpdate(nextProps, nextState, a) a ? <code>react 17. 废弃</code></h3> <h3 id="componentdidupdate-nextprops-nextstate-会在服务端调用-说明代码有问题"><a href="#componentdidupdate-nextprops-nextstate-会在服务端调用-说明代码有问题" aria-hidden="true" class="header-anchor">#</a> componentDidUpdate(nextProps, nextState) 会在服务端调用 说明代码有问题</h3> <h2 id="react组件state和props的局限性"><a href="#react组件state和props的局限性" aria-hidden="true" class="header-anchor">#</a> React组件state和props的局限性</h2> <h2 id="问题-2"><a href="#问题-2" aria-hidden="true" class="header-anchor">#</a> 问题</h2> <ul><li>constructor的第二个参数 ？ ``</li> <li>componentWillUpdate 的第三个参数 ？ <code>客户端服务点都调用</code></li> <li></li></ul> <h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <ul><li><p>react 强制刷新页面<code>his.forceUpdate();</code></p></li> <li><p>https://segmentfault.com/q/1010000011289209</p></li> <li><p>https://segmentfault.com/q/1010000011289209
eventClick</p></li> <li><p>父组件专递事件给子组件，父组建也会进入render - 》子组件</p></li> <li><p>最上层的根组件需要重新render，必定导致其所有子组件都要重新render，</p></li> <li><p>1、执行了render方法不代表会更新dom树，在react当中你使用了setstate更新了state或者改变了传入的props，都会执行render方法，执行了render方法以后，才会生成dom树进行对比，如果dom有差异才会进行构建新的渲染树，更新对应的dom，否则，不会更新。因此，生成虚拟dom树进行对比是在render函数执行了之后进行，而不是执行之前。</p></li> <li><p>2、拆分组件有助于性能优化。组件拆分了，各组件之间的耦合性小了，某个子组件需要更新的时候，牵涉到其他的组件就少，就能减少牵一发而动全身这种情况。</p></li></ul></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/v-ZHD-loong/react-redux/Thefirstone.html" class="prev">
          第一章
        </a></span> <span class="next"><a href="/v-ZHD-loong/css/">
          Introduction
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/v-ZHD-loong/assets/js/12.5e663ca4.js" defer></script><script src="/v-ZHD-loong/assets/js/app.7f934088.js" defer></script>
  </body>
</html>
